var Prism = require('prismjs')

var jsx = Prism.util.clone(Prism.languages.javascript)
  , jsxExpression;

Prism.languages.jsx = Prism.languages.extend('markup', jsx);

Prism.languages.jsx.tag.pattern =
  /<\/?[\w\.:-]+\s*(?:\s+[\w\.:-]+(?:=(?:("|')(\\?[\w\W])*?\1|[^\s'">=]+|(\{[\w\W]*?\})))?\s*)*\/?>/i;

Prism.languages.jsx.tag.inside['attr-value'].pattern = /=[^\{](?:('|")[\w\W]*?(\1)|[^\s>]+)/i;

jsxExpression = Prism.util.clone(Prism.languages.jsx)

delete jsxExpression.punctuation

jsxExpression = Prism.languages.insertBefore('jsx', 'operator', {
  'punctuation': /=(?={)|[{}[\];(),.:]/
}, { jsx: jsxExpression })


Prism.languages.insertBefore('inside', 'attr-value', {
	script: {
		pattern: /=(\{(?:\{[^}]*\}|[^}])+\})/i,
		inside: jsxExpression,
		alias: 'language-javascript'
	}
}, Prism.languages.jsx.tag);

module.exports = Prism;
